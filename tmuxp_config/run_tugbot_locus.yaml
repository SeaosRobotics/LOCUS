session_name: locus_dataset

environment:
  # Path for the dataset
  DATA_PATH: /home/deneth/datalogs/kawasaki/yako_new_layout
  DATA_FOLDER: yako_new_layout/
  # Change the run number to save the output data in a different folder
  RUN_NUMBER: "test_99"

  # version of logging. If unsure, select 2 (the latest). 1 is for tunnel datasets
  LOG_VERSION: "1" 
  # Number of lidars to use (if available)
  NUM_VLP: "1"

  # Change the robot name and type to match the dataset 
  ROBOT_NAME: tugbot1
  ROBOT_TYPE: tugbot
  # If unsure, leave as base1
  BASE_NAME: base1
  
  # Rosbag parameters
  START: "5"
  RATE: "1.0"

  # See https://github.com/NeBula-Autonomy/nebula-odometry-dataset/blob/main/pages/dataset.md 
  # for the expected length of datasets
  # This param can be used to automatically close the session at the end of the run (currently disabled)
  TIME_TO_END: "1600"
  # This param is used to start saving the map near the end of the run (try 1 minute before the end)
  TIME_TO_MAP_SAVE: "5"
  # The topic for the odometry to record
  ODOM: locus/odometry


options:
  default-command: /bin/bash

windows:
- window_name: locus  
  focus: true  
  layout: tiled  
  shell_command_before:
    - source devel/setup.bash
    - rosparam set /use_sim_time true   
    # Set up the parameter files from the Ground truth products
    # - cp $DATA_PATH/fiducial_calibration_$ROBOT_NAME.yaml ~/.ros/
    # - if [ $ROBOT_TYPE = 'tugbot' ]; then
    # cp $DATA_PATH/$ROBOT_NAME*.yaml $(rospack find sensor_description)/config/ ;
    #  fi;
    
  panes:

    ################################### RUN ###################################

    # Bags and topics of interest (switching if the log versions is older)
    - if [ $LOG_VERSION -eq 1 ]; then
      sleep 10;rosbag play $DATA_PATH/2022-07-25-15-16-27.bag -s$START -r$RATE --clock  --prefix $ROBOT_NAME/ 
      --topics clock:=/clock /velodyne_points /imu/data /wheels_controller/odom ;
      fi;

    # launch rviz
    - rviz -d $(rospack find locus)/rviz/$(echo $ROBOT_NAME)_locus.rviz

    # Front-end
    - if [ $ROBOT_TYPE = 'tugbot' ]; then
      roslaunch locus locus_tugbot.launch robot_namespace:=$ROBOT_NAME number_of_velodynes:=$NUM_VLP;
      fi

- window_name: record_at_end  
  focus: false  
  layout: tiled  
  shell_command_before:
    - rosparam set /use_sim_time true   

  panes:
    # Map
    # Front-End Map
    - sleep $TIME_TO_MAP_SAVE; rosrun pcl_ros pointcloud_to_pcd input:=/$ROBOT_NAME/locus/octree_map _prefix:=$DATA_PATH/locus_$RUN_NUMBER/map_locus 
    
    # ..
    - 


- window_name: record  
  focus: false  
  layout: tiled  
  shell_command_before:
    - mkdir $DATA_PATH/locus_$RUN_NUMBER
    - rosparam set /use_sim_time true   

  panes:

    ################################### RECORD ###################################

    # Odometry 
  #  - rosbag record -O $DATA_PATH/locus_$RUN_NUMBER/odometry.bag /$ROBOT_NAME/$ODOM /$ROBOT_NAME/locus/localization_integrated_estimate /$ROBOT_NAME/locus/odometry_integrated_estimate /$ROBOT_NAME/locus/localization_incremental_estimate /$ROBOT_NAME/locus/odometry_incremental_estimate  
  #  - rosbag record -O $DATA_PATH/locus_$RUN_NUMBER/stationary.bag /$ROBOT_NAME/stationary_accel

    # Odometry Rate and Delay
  #  - rostopic hz /$ROBOT_NAME/$ODOM -w3 >> $DATA_PATH/locus_$RUN_NUMBER/rate.txt
  #  - rostopic delay /$ROBOT_NAME/$ODOM -w3 >> $DATA_PATH/locus_$RUN_NUMBER/delay.txt

    # Computation Time Profiling
  #  - rosbag record -O $DATA_PATH/locus_$RUN_NUMBER/lidar_callback_duration.bag /$ROBOT_NAME/locus/lidar_callback_duration
  #  - rosbag record -O $DATA_PATH/locus_$RUN_NUMBER/scan_to_scan_duration.bag /$ROBOT_NAME/locus/scan_to_scan_duration
  #  - rosbag record -O $DATA_PATH/locus_$RUN_NUMBER/scan_to_map_duration.bag /$ROBOT_NAME/locus/scan_to_submap_duration

    ################################ END RECORDING ###############################
    # Uncomment the line below to automatically end the run
    # - sleep $TIME_TO_END; rosnode kill -a 
    # Use the line below to prepare a kill command when you want to stop
    - rosnode kill -a \
